# Payment Processing Service

–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π —Å —É—á—ë—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –≤–Ω–µ—à–Ω–∏–º –ø–ª–∞—Ç—ë–∂–Ω—ã–º —à–ª—é–∑–æ–º (–∏–º–∏—Ç–∞—Ü–∏—è).

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Å —É–ø–æ—Ä–æ–º –Ω–∞:

* —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
* –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
* –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
* —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

---

## üß† –û–±—â–∞—è –∏–¥–µ—è

–°–µ—Ä–≤–∏—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞–∑–æ–≤–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
* –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ (–¥–µ–ø–æ–∑–∏—Ç) –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –±–∞–ª–∞–Ω—Å —Å —É—á—ë—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏
* —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π –∏ –∫–æ–º–∏—Å—Å–∏–π

API –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ, —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã (–ø–æ–∫–∞ –±–µ–∑ Celery).

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ **—Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (Clean Architecture)**:

```
API ‚Üí Application ‚Üí Domain
‚Üì
Infrastructure
```

### –°–ª–æ–∏:

* **Domain** ‚Äî –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤)
* **Application** ‚Äî use cases –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
* **Infrastructure** ‚Äî –ë–î, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
* **API** ‚Äî HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (FastAPI)
* **Workers** ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ payments.py          # –¥–µ–ø–æ–∑–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ users.py             # —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ health.py
‚îÇ       ‚îî‚îÄ‚îÄ schemas/
‚îÇ           ‚îú‚îÄ‚îÄ users.py         # —Å—Ö–µ–º—ã –¥–ª—è User
‚îÇ           ‚îî‚îÄ‚îÄ payment.py       # —Å—Ö–µ–º—ã –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ use_cases/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_user.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deposit_balance.py
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payment.py           # DTO –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ enums/
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transaction.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_gateway/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http.py
‚îÇ   ‚îú‚îÄ‚îÄ queue/
‚îÇ   ‚îî‚îÄ‚îÄ cache/
‚îú‚îÄ‚îÄ workers/                     # –ø–æ–∫–∞ –ø—É—Å—Ç–æ
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îú‚îÄ‚îÄ logging.py
‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py
‚îî‚îÄ‚îÄ main.py
```

---

## üîå API versioning

–í—Å–µ HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ–¥ –≤–µ—Ä—Å–∏–µ–π:

```
/api/v1/*
```

–í–µ—Ä—Å–∏—è –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `api/v1/__init__.py`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* –ø–æ–¥–∫–ª—é—á–∞—Ç—å API –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π
* –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
* –≤ –±—É–¥—É—â–µ–º –±–µ–∑–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `v2`

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **environment variables** –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `pydantic-settings`.

–ü—Ä–∏–º–µ—Ä `.env`:

```env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/payments
REDIS_URL=redis://localhost:6379/0
PAYMENT_GATEWAY_URL=http://localhost:8001
TRANSACTION_FEE=2
```

---

## üöÄ –ó–∞–ø—É—Å–∫ (–Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
poetry install
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
uvicorn app.main:app --reload
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

* Swagger UI: `http://localhost:8000/docs`
* Health-check: `GET /api/v1/health`
* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `POST /api/v1/users/`
* –î–µ–ø–æ–∑–∏—Ç: `POST /api/v1/payments/deposit`

---

## üìå –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

* –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
* —Å–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
* versioned API
* health-check
* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ env
* **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:

  * use case `create_user`
  * —Å—Ö–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `schemas/users.py`
  * —Å—É—â–Ω–æ—Å—Ç—å `User` –≤ `domain/entities/user.py`
  * —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `UserRepository`
  * POST-—ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/users/`
* **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–¥–µ–ø–æ–∑–∏—Ç)**:

  * use case `deposit_balance`
  * DTO `DepositDTO`
  * —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `PaymentRepository`, `TransactionRepository`
  * —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/payments/deposit`
  * —Ä–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏ 2%
  * –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  * –∑–∞–ø–∏—Å—å –ø–ª–∞—Ç–µ–∂–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î
  * –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é SQLAlchemy

‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ:

* –í—ã—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ (withdraw)
* –§–æ–Ω–æ–≤—ã–µ –≤–æ—Ä–∫–µ—Ä—ã (Celery)
* Retry –∏ Dead Letter Queue
* Docker Compose

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
(—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è domain –∏ application —Å–ª–æ—ë–≤).

---

## üìÑ –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ.
README –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
